<%
 n = my[:network_info]
 p = my[:network_params]
 jorm_stats = my[:jorm_stats]
 jorm_settings = my[:jorm_settings]
%>
<div class="row" style="margin-left:30px;">
<form action="/connect-jorm" method="POST">
  <div class="form-row">
    <div class="col">
      <div class="input-group-prepend">
        <div class="input-group-text">
          <img src="https://img.icons8.com/ios-glyphs/16/000000/snake.png" title="Jörmungandr port">
          <img src="https://img.icons8.com/color/16/000000/<%= session[:j_connected] ? "usb-connected.png" : "usb-disconnected.png"%>">
        </div>
        <div class="input-group">
          <input title="Jörmungandr port" placeholder="Jörm port" type="text" value="<%=session[:jorm_port]%>" name="jorm_port"
                class="form-control">
        </div>
      </div>
      <small id="help" class="form-text text-muted">Jörmungandr port.</small>

    </div>
    <div class="col">
      <button type="submit" class="btn btn-info">Refresh</button>
    </div>
  </div>
</form>
</div>
<div class="row" style="margin-top:20px; margin-left:10px;">
  <div class="col-4">
    <!-- JORMUNGANDR STATS AND SETTINGS -->
    <div class="list-group">
      <div class="list-group-item">
         Jörmungandr Stats & Settings
      </div>
      <% if (jorm_stats && jorm_settings) %>
        <div class="list-group-item">
          <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">Stats</h5>
          </div>
          <small><b>version: </b> <%= jorm_stats['version'] %></small><br/>
          <small><b>state: </b> <%= jorm_stats['state'] %></small><br/>
          <small><b>blockRecvCnt: </b> <%= jorm_stats['blockRecvCnt'] %></small><br/>
          <small><b>lastBlockDate: </b> <%= jorm_stats['lastBlockDate'] %></small><br/>
          <small><b>lastBlockFees: </b> <%= jorm_stats['lastBlockFees'] %></small><br/>
          <small><b>lastBlockHash: </b> <%= jorm_stats['lastBlockHash'] %></small><br/>
          <small><b>lastBlockHeight: </b> <%= jorm_stats['lastBlockHeight'] %></small><br/>
          <small><b>lastBlockSum: </b> <%= jorm_stats['lastBlockSum'] %></small><br/>
          <small><b>lastBlockTime: </b> <%= jorm_stats['lastBlockTime'] %></small><br/>
          <small><b>lastReceivedBlockTime: </b> <%= jorm_stats['lastReceivedBlockTime'] %></small><br/>
          <small><b>lastBlockTx: </b> <%= jorm_stats['lastBlockTx'] %></small><br/>
          <small><b>txRecvCnt: </b> <%= jorm_stats['txRecvCnt'] %></small><br/>
          <small><b>uptime: </b> <%= jorm_stats['uptime'] %></small><br/>
        </div>
        <div class="list-group-item">
          <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">Settings</h5>
          </div>
          <small><b>block0Hash: </b>  <%= jorm_settings['block0Hash'] %></small><br/>
          <small><b>block0Time: </b>  <%= jorm_settings['block0Time'] %></small><br/>
          <small><b>consensusVersion: </b>  <%= jorm_settings['consensusVersion'] %></small><br/>
          <small><b>currSlotStartTime: </b>  <%= jorm_settings['currSlotStartTime'] %></small><br/>
          <% if jorm_settings['fees'] %>
          <small><b>fees: </b>  </small><br/>
          <small> <%= jorm_settings['fees'] %> </small><br />
          <% end %>
          <% if jorm_settings['rewardParams'] %>
          <small><b>rewardParams: </b></small><br/>
          <small>  <%= jorm_settings['rewardParams'] %></small><br/>
          <% end %>

          <small><b>slotDuration: </b>  <%= jorm_settings['slotDuration'] %></small><br/>
          <small><b>slotsPerEpoch: </b>  <%= jorm_settings['slotsPerEpoch'] %></small><br/>
          <% if jorm_settings['treasuryTax'] %>
          <small><b>treasuryTax: </b></small><br/>
          <small>  <%= jorm_settings['treasuryTax'] %></small><br/>
          <% end %>
        </div>
      <% else %>
        <div class="alert alert-danger" role="alert">Cannot connect to Jörmungandr! Is port correct? [PORT = <%= session[:jorm_port] %>]</div>
      <% end %>
    </div>
  </div>
  <div class="col">
    <!-- NETWORK INFORMATION -->

    <div class="list-group">
      <div class="list-group-item">
         Network information (from wallet backend)
      </div>
      <% if n %>
        <div class="list-group-item">
          <small><b>Network tip: </b></small><br/>
          <small>&nbsp;&nbsp;<b>Epoch: </b><%= n['network_tip']['epoch_number'] %></small><br/>
          <small>&nbsp;&nbsp;<b>Slot: </b><%= n['network_tip']['slot_number'] %></small><br/>
          <small><b>Node tip: </b></small><br/>
          <small>&nbsp;&nbsp;<b>Epoch: </b><%= n['node_tip']['epoch_number'] %></small><br/>
          <small>&nbsp;&nbsp;<b>Slot: </b><%= n['node_tip']['slot_number'] %></small><br/>
          <small>&nbsp;&nbsp;<b>Height: </b><%= "#{n['node_tip']['height']['quantity']} block" %></small><br/>
          <small>
          <b>Status:</b> <%= n['sync_progress']['status'] %>
                         <%= n['sync_progress']['status'] == "syncing" ? ", Progress: #{n['sync_progress']['progress']['quantity']}%" : ""%>
          </small><br/>
          <small><b>Next epoch: </b></small><br/>
          <small>&nbsp;&nbsp;<b>Epoch start time: </b><%= n['next_epoch']['epoch_start_time'] %></small><br/>
          <small>&nbsp;&nbsp;<b>Epoch number: </b><%= n['next_epoch']['epoch_number'] %></small><br/>
        </div>
      <% else %>
        <div class="alert alert-danger" role="alert">Cannot connect to wallet backend! Is port correct? [PORT = <%= session[:wallet_port] %>]</div>
      <% end %>
    </div>

    <!-- NETWORK PARAMETERS -->

    <div class="list-group">
      <div class="list-group-item">
         Network parameters (from wallet backend)
         <small>Epoch: "latest"</a></small>
      </div>
      <div class="list-group-item">
        <small><b>Slot length: </b>
          <%= "#{p['slot_length']['quantity']} #{p['slot_length']['unit']}" %>
        </small><br/>
        <small><b>Epoch stability: </b>
          <%= "#{p['epoch_stability']['quantity']} #{p['epoch_stability']['unit']}" %>
        </small><br/>
        <small><b>Epoch length: </b>
          <%= "#{p['epoch_length']['quantity']} #{p['epoch_length']['unit']}" %>
        </small><br/>
        <small><b>Active slot coefficient: </b>
          <%= "#{p['active_slot_coefficient']['quantity']} #{p['active_slot_coefficient']['unit']}" %>
        </small><br/>
        <small><b>Genesis block hash: </b>
          <%= p['genesis_block_hash'] %>
        </small><br/>
        <small><b>Blockchain start time: </b>
          <%= p['blockchain_start_time'] %>
        </small><br/>
      </div>
    </div>


  </div>
</div>
